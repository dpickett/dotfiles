#!/usr/bin/env zsh

{{ if eq .chezmoi.os "linux" -}}
# Source shared utilities
if [[ -f ~/.local/lib/chezmoi/utils.sh ]]; then
    source ~/.local/lib/chezmoi/utils.sh
else
    echo "Warning: utils.sh not found, defining install_packages function locally"
    install_packages() {
        if command -v pacman >/dev/null 2>&1; then
            sudo pacman -S --needed "$@"
        elif command -v apt-get >/dev/null 2>&1; then
            sudo apt-get update && sudo apt-get install -y "$@"
        elif command -v dnf >/dev/null 2>&1; then
            sudo dnf install -y "$@"
        elif command -v zypper >/dev/null 2>&1; then
            sudo zypper install -y "$@"
        else
            echo "Error: Unsupported Linux distribution"
            return 1
        fi
    }
fi

# Install basic packages
install_packages git curl wget
{{ else -}}
brew bundle --no-lock --file=/dev/stdin <<EOF
brew "awscli"
brew "bat"
brew "ripgrep"
brew "coreutils"
brew "gpg"
brew "gawk"

cask "dbeaver-community"
cask "docker"
cask "figma"
cask "font-fira-code-nerd-font"
cask "google-chrome"
cask "google-chrome@canary"
cask "iterm2"
cask "microsoft-outlook"
cask "microsoft-teams"
cask "obsidian"
cask "postgres-unofficial"
cask "signal"
cask "slack"
cask "spotify"
cask "raycast"
cask "visual-studio-code"
cask "vivaldi"
cask "zoom"
hidutil property --set "$(cat ~/.config/osx/keyboard_remap.json)"
EOF
{{ end -}}

[[ -d ~/.antidote ]] || git clone https://github.com/mattmc3/antidote ~/.antidote

. ~/.antidote/antidote.zsh
. ~/.asdf/asdf.sh

asdf plugin add ruby
asdf plugin add nodejs
asdf plugin add yarn

touch .custom.zsh
